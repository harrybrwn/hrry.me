version: "3.8"
services:
  api:
    build:
      x-bake:
        tags:
          - 10.0.0.101:5000/harrybrwn/api:latest
          - ${REGISTRY}/harrybrwn/api:${GIT_COMMIT}
          - ${REGISTRY}/harrybrwn/api:${GIT_BRANCH}
        platforms:
          - linux/amd64
          - linux/arm/v7
  hooks:
    build:
      x-bake:
        tags:
          - 10.0.0.101:5000/harrybrwn/hooks:latest
          - ${REGISTRY}/harrybrwn/hooks:${GIT_COMMIT}
          - ${REGISTRY}/harrybrwn/hooks:${GIT_BRANCH}
        platforms:
          - linux/amd64
          - linux/arm/v7
  grafana:
    build:
      x-bake:
        tags:
          - 10.0.0.101:5000/harrybrwn/grafana:latest
          - ${REGISTRY}/harrybrwn/grafana:${GIT_COMMIT}
          - ${REGISTRY}/harrybrwn/grafana:${GIT_BRANCH}
        platforms:
          - linux/amd64
          - linux/arm/v7

  # fluentbit:
  #   build:
  #     x-bake:
  #       tags:
  #         - 10.0.0.101:5000/harrybrwn/fluent-bit:latest
  #       platforms:
  #         - linux/amd64
  #         - linux/arm/v7
  # loki:
  #   build:
  #     x-bake:
  #       tags:
  #         - 10.0.0.101:5000/harrybrwn/loki:latest
  #       platforms:
  #         - linux/amd64
  #         - linux/arm/v7
