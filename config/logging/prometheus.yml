global:
  scrape_interval: 30s

scrape_configs:
  - job_name: prometheus
    static_configs:
      - targets: ["localhost:9090"]

  # https://www.innoq.com/en/blog/scraping-docker-swarm-service-instances-with-prometheus/
  - job_name: fluentbit
    dns_sd_configs:
      - names:
          - 'tasks.fluentbit'
        type: 'A'
        port: 2020
    metrics_path: /api/v1/metrics/prometheus
  - job_name: node_exporter_metrics
    dns_sd_configs:
      - names:
          - 'tasks.fluentbit'
        type: 'A'
        port: 2021
    scrape_interval: 10s
    metrics_path: /metrics

  - job_name: api
    metrics_path: /api/metrics/prometheus
    static_configs:
      - targets: ["api:8081"]

  - job_name: minio-cluster
    metrics_path: /minio/v2/metrics/cluster
    scheme: http
    static_configs:
      - targets: ["s3:9000"]
  - job_name: minio-node
    metrics_path: /minio/v2/metrics/node
    scheme: http
    static_configs:
      - targets: ["s3:9000"]

  - job_name: docker-registry
    dns_sd_configs:
      - names:
        - 'tasks.registry'
        type: 'A'
        port: 5001

  - job_name: nginx-metrics-exporter
    static_configs:
      - targets: ["nginx-metrics-exporter:9113"]

  - job_name: backups
    static_configs:
      - targets: ["backups:8082"]

  - job_name: loki
    static_configs:
      - targets: ["loki:3100"]
  - job_name: grafana
    static_configs:
      - targets: ["grafana:3000"]
