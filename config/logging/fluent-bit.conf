[SERVICE]
    # log_level debug
    # import parsers defined in a parsers file
    Parsers_File /fluent-bit/etc/parsers.conf

# Collect docker logs via fluend logging driver
[INPUT]
    Name forward
    Listen 0.0.0.0
    port 24224

# try parsing log as json and lift its keys to the first-level
[FILTER]
    Name parser
    Parser json
    Match docker.logs.*
    Key_Name log
    Reserve_Data On

[FILTER]
    Name record_modifier
    Match docker.logs.*
    Record hostname ${HOSTNAME}

[OUTPUT]
    Name        loki
    Match       docker.logs.*
    labels      job=fluentbit, type=logs
    label_keys  $container_name, $container_id
    remove_keys container_name, container_id
    host        loki
    port        3100
    http_user   admin
    http_passwd admin
    tls         off
    tls.verify  off

# Metrics
[INPUT]
    Name docker
    Tag metrics.docker
    Interval_Sec 15
[OUTPUT]
    Name        loki
    Match       metrics.*
    labels      job=fluentbit, type=metrics
    host        loki
    port        3100
    http_user   admin
    http_passwd admin
    tls         off
    tls.verify  off

# Docker events
[INPUT]
    Name   docker_events
    Tag    logs.dockerhost
    Parser docker_host_events
[OUTPUT]
    Name   loki
    Match  logs.dockerhost
    labels job=docker, type=logs
    host   loki
    port   3100
    http_user   admin
    http_passwd admin
    tls        off
    tls.verify off

# [OUTPUT]
#     Name stdout
#     Match *
