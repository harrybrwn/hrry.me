# Default values for hrry.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Creates new namespaces
namespaces:
  - cert-manager
  - prometheus

cert-manager:
  enabled: true
  namespace: cert-manager
  installCRDs: true

prometheus:
  enabled: true
  forceNamespace: prometheus
  kube-state-metrics:
    namespaceOverride: prometheus
  alertmanager:
    enabled: false
  pushgateway:
    enabled: false
  server:
    enabled: true
    fullnameOverride: prometheus
    service:
      servicePort: 9090
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: "hrry.me/node-size"
              operator: In
              values: ["big"] # big, small
    extraArgs:
      log.format: json
    global:
      scrape_interval: 15s
      evaluation_interval: 15s
  extraScrapeConfigs: |
    - job_name: nginx-metrics-exporter
      static_configs:
        - targets: ["nginx-metrics-exporter.default.svc.cluster.local:9113"]

    - job_name: minio-cluster
      metrics_path: /minio/v2/metrics/cluster
      scheme: http
      static_configs:
        - targets: ["s3.default.svc.cluster.local:9000"]
    - job_name: minio-node
      metrics_path: /minio/v2/metrics/node
      scheme: http
      scrape_interval: 60s
      static_configs:
        - targets: ["s3.default.svc.cluster.local:9000"]
    - job_name: api
      dns_sd_configs:
        - names: ['api.default.svc.cluster.local']
          type: 'A'
          port: 8081
    - job_name: loki
      static_configs:
        - targets: ["loki.default.svc.cluster.local:3100"]
    - job_name: grafana
      static_configs:
        - targets: ["grafana.default.svc.cluster.local:3000"]

redis:
  enabled: false
  namespace: redis
  nameOverride: redis
  fullnameOverride: redis
  mode: standalone

# TODO put this in the redis chart
prometheus-redis-exporter:
  enabled: false
  namespace: prometheus
  redisAddress: redis://redis-0.redis:6379
  auth:
    enabled: true
    redisPassword: testbed01
  service:
    type: ClusterIP
    port: 9121
    portName: redis-exporter
  serviceMonitor:
    enabled: false
    multipleTargets: true
    targets:
    - url: redis://redis-0.redis:6379
      name: "redis-0"
    - url: redis://redis-1.redis:6379
      name: "redis-1"
    additionalRelabeling:
    - sourceLabels: [type]
      targetLabel: type
      replacement: cluster
    additionalMetricsRelabels:
      type: cluster
  rbac:
    pspEnabled: false
