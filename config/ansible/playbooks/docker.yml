- hosts: nodes
  become: true
  become_user: root
  become_method: sudo
  tasks:
    - name: create docker certs dirs
      file:
        path: '/etc/docker/{{ item.path }}'
        owner: root
        group: root
        mode: '0755'
        state: directory
        recurse: yes
      loop:
        - { path: certs.d }
        - { path: certs.d/10.0.0.11:5000 }
        - { path: registry }
    - name: install root ca
      template:
        src: ../../docker-root-ca.pem
        dest: /etc/docker/certs.d/10.0.0.11:5000/ca.crt
        owner: root
        group: root
        validate: openssl x509 -noout -text -in %s
        backup: true
    #- { name: print stuff, debug: { var: ansible_facts } }