{"annotations":{"list":[{"builtIn":1,"datasource":{"type":"datasource","uid":"grafana"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","target":{"limit":100,"matchAny":false,"tags":[],"type":"dashboard"},"type":"dashboard"}]},"description":"Official dashboard for NGINX Prometheus exporter","editable":true,"fiscalYearStartMonth":0,"graphTooltip":0,"id":4,"links":[],"liveNow":false,"panels":[{"collapsed":false,"datasource":{"uid":"${DS_PROMETHEUS}"},"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":4,"panels":[],"title":"Status","type":"row"},{"datasource":{"uid":"${DS_PROMETHEUS}"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[{"options":{"0":{"text":"Down"},"1":{"text":"Up"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"#E02F44","value":null},{"color":"#FF9830","value":1},{"color":"#299c46","value":1}]},"unit":"none"},"overrides":[]},"gridPos":{"h":4,"w":24,"x":0,"y":1},"id":8,"links":[],"maxDataPoints":100,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.1.4","repeat":"instance","repeatDirection":"h","targets":[{"expr":"nginx_up{instance=~\"$instance\"}","format":"time_series","instant":false,"intervalFactor":1,"refId":"A"}],"title":"NGINX Status for $instance","type":"stat"},{"collapsed":false,"datasource":{"uid":"${DS_PROMETHEUS}"},"gridPos":{"h":1,"w":24,"x":0,"y":9},"id":6,"panels":[],"title":"Metrics","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"uid":"${DS_PROMETHEUS}"},"description":"","fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":10},"hiddenSeries":false,"id":10,"legend":{"alignAsTable":false,"avg":false,"current":false,"hideEmpty":false,"max":false,"min":false,"rightSide":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.1.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"irate(nginx_connections_accepted{instance=~\"$instance\"}[5m])","format":"time_series","instant":false,"intervalFactor":1,"legendFormat":"{{instance}} accepted","refId":"A"},{"expr":"irate(nginx_connections_handled{instance=~\"$instance\"}[5m])","format":"time_series","instant":false,"intervalFactor":1,"legendFormat":"{{instance}} handled","refId":"B"}],"thresholds":[],"timeRegions":[],"title":"Processed connections","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"decimals":1,"format":"short","label":"Connections (rate)","logBase":1,"show":true},{"format":"short","label":"","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"uid":"${DS_PROMETHEUS}"},"decimals":0,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":10},"hiddenSeries":false,"id":12,"legend":{"alignAsTable":false,"avg":false,"current":false,"max":false,"min":false,"rightSide":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.1.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"nginx_connections_active{instance=~\"$instance\"}","format":"time_series","intervalFactor":1,"legendFormat":"{{instance}} active","refId":"A"},{"expr":"nginx_connections_reading{instance=~\"$instance\"}","format":"time_series","intervalFactor":1,"legendFormat":"{{instance}} reading","refId":"B"},{"expr":"nginx_connections_waiting{instance=~\"$instance\"}","format":"time_series","intervalFactor":1,"legendFormat":"{{instance}} waiting","refId":"C"},{"expr":"nginx_connections_writing{instance=~\"$instance\"}","format":"time_series","intervalFactor":1,"legendFormat":"{{instance}} writing","refId":"D"}],"thresholds":[],"timeRegions":[],"title":"Active Connections","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"decimals":0,"format":"short","label":"Connections","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"uid":"${DS_PROMETHEUS}"},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":24,"x":0,"y":17},"hiddenSeries":false,"id":15,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.1.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"irate(nginx_http_requests_total{instance=~\"$instance\"}[5m])","format":"time_series","intervalFactor":1,"legendFormat":"{{instance}} total requests","refId":"A"}],"thresholds":[],"timeRegions":[],"title":"Total requests","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":25},"id":19,"panels":[],"title":"Logs","type":"row"},{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"hideFrom":{"legend":false,"tooltip":false,"viz":false}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[]},"gridPos":{"h":20,"w":16,"x":0,"y":26},"id":28,"options":{"basemap":{"config":{},"name":"Layer 0","type":"default"},"controls":{"mouseWheelZoom":true,"showAttribution":true,"showDebug":false,"showScale":true,"showZoom":true},"layers":[{"config":{"showLegend":true,"style":{"color":{"fixed":"dark-green"},"opacity":0.4,"rotation":{"fixed":0,"max":360,"min":-360,"mode":"mod"},"size":{"fixed":2,"max":5,"min":1},"symbol":{"fixed":"img/icons/marker/circle.svg","mode":"fixed"},"text":{"fixed":"","mode":"field"},"textConfig":{"fontSize":12,"offsetX":0,"offsetY":0,"textAlign":"center","textBaseline":"middle"}}},"location":{"mode":"coords"},"name":"Requests","tooltip":true,"type":"markers"}],"tooltip":{"mode":"details"},"view":{"id":"coords","lat":16.488681,"lon":10.062539,"shared":false,"zoom":2.02}},"pluginVersion":"9.1.4","targets":[{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"editorMode":"code","expr":"{app=\"nginx\"}\n  | json\n  | host !~ \"registry.*\" and\n    source != \"stderr\" and latitude != \"\" and longitude != \"\"","queryType":"range","refId":"A"}],"title":"GeoIP Map","transformations":[{"id":"extractFields","options":{"format":"json","replace":true,"source":"labels"}},{"id":"filterFieldsByName","options":{"include":{"names":["city","country_code","duration_ms","host","https","internal_uri","latitude","loc_radius","local_time","longitude","method","protocol","referer","remote_addr","request_uri","server_name","status","user_agent","as_org"]}}},{"id":"convertFieldType","options":{"conversions":[{"destinationType":"number","targetField":"longitude"},{"destinationType":"number","targetField":"latitude"},{"destinationType":"number","targetField":"loc_radius"},{"destinationType":"number","targetField":"duration_ms"}],"fields":{}}}],"type":"geomap"},{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"gridPos":{"h":20,"w":24,"x":0,"y":46},"id":17,"options":{"dedupStrategy":"none","enableLogDetails":true,"prettifyLogMessage":false,"showCommonLabels":false,"showLabels":false,"showTime":true,"sortOrder":"Descending","wrapLogMessage":false},"targets":[{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"editorMode":"code","expr":"{app=\"nginx\"}\n  | json\n  | server_name !~ \"grafana.*\"","queryType":"range","refId":"A"}],"title":"nginx logs","transformations":[{"id":"extractFields","options":{"format":"json","replace":false,"source":"labels"}},{"id":"filterFieldsByName","options":{"include":{"names":["Time","Line","tsNs","id","container_id","container_name","env","hostname","job","level","message","pid","service","source","tid","type","args","cf_connecting_ip","cf_ipcountry","cf_ray","connection","connection_requests","content_type","continent_code","country_code","duration_ms","host","https","internal_uri","latitude","loc_radius","local_time","longitude","method","protocol","referer","remote_addr","request_uri","server_name","ssl_server_name","status","user_agent","x_forwarded_for","x_real_ip","city"]}}}],"type":"logs"},{"collapsed":true,"gridPos":{"h":1,"w":24,"x":0,"y":66},"id":32,"panels":[{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"}]}},"overrides":[]},"gridPos":{"h":6,"w":3,"x":0,"y":63},"id":24,"options":{"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showThresholdLabels":false,"showThresholdMarkers":false},"pluginVersion":"9.1.4","targets":[{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"editorMode":"code","expr":"sum(count_over_time({app=\"nginx\"}[$__range]))","queryType":"range","refId":"A"}],"title":"Logs Count","type":"gauge"},{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"}]}},"overrides":[]},"gridPos":{"h":7,"w":14,"x":3,"y":63},"id":26,"options":{"displayMode":"gradient","minVizHeight":10,"minVizWidth":0,"orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showUnfilled":true},"pluginVersion":"9.1.4","targets":[{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"editorMode":"code","expr":"sum by (host) (\n  count_over_time(\n    {app=\"nginx\"}\n    | json\n    | host != \"\"\n    [$__range]\n  )\n)","legendFormat":"{{host}}","queryType":"range","refId":"A"}],"title":"Requests By Host","transformations":[],"type":"bargauge"},{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"}]}},"overrides":[]},"gridPos":{"h":7,"w":5,"x":19,"y":63},"id":21,"options":{"displayMode":"gradient","minVizHeight":10,"minVizWidth":0,"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showUnfilled":false},"pluginVersion":"9.1.4","targets":[{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"editorMode":"code","expr":"sum by (method) (\n  count_over_time(\n    {app=\"nginx\"}\n    | json\n    | method != \"\"\n    [$__range]\n  )\n)","legendFormat":"{{method}}","queryType":"range","refId":"A"}],"title":"Request Method","type":"bargauge"},{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"}]}},"overrides":[]},"gridPos":{"h":7,"w":14,"x":0,"y":70},"id":29,"options":{"displayMode":"gradient","minVizHeight":10,"minVizWidth":0,"orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showUnfilled":true},"pluginVersion":"9.1.4","targets":[{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"editorMode":"code","expr":"sum by (request_uri) (\n  count_over_time(\n    {app=\"nginx\"}\n    | json\n    | host != \"\"\n    [$__range]\n  )\n)","legendFormat":"{{host}}","queryType":"range","refId":"A"}],"title":"Requests By Path","transformations":[],"type":"bargauge"},{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"}]}},"overrides":[]},"gridPos":{"h":7,"w":10,"x":14,"y":70},"id":22,"options":{"displayMode":"gradient","minVizHeight":10,"minVizWidth":0,"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showUnfilled":false},"pluginVersion":"9.1.4","targets":[{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"editorMode":"code","expr":"sum by (cf_ipcountry) (\n  count_over_time(\n    {app=\"nginx\"}\n    | json\n    | cf_ipcountry != \"\"\n    [$__range]\n  )\n)","legendFormat":"{{cf_ipcountry}}","queryType":"range","refId":"A"}],"title":"Country Code","transformations":[],"type":"bargauge"},{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"}]}},"overrides":[]},"gridPos":{"h":7,"w":7,"x":0,"y":77},"id":33,"options":{"displayMode":"gradient","minVizHeight":10,"minVizWidth":0,"orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showUnfilled":true},"pluginVersion":"9.1.4","targets":[{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"editorMode":"code","expr":"sum by (referer) (\n  count_over_time(\n    {app=\"nginx\"}\n    | json\n    | referer !~ \"^http(s)?://(.*\\\\.)?(hrry|harrybrwn|hryb).(com|lol|dev|me).*\"\n    [$__range]\n  )\n)","legendFormat":"{{host}}","queryType":"range","refId":"A"}],"title":"Requests by Referer","transformations":[],"type":"bargauge"},{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"}]}},"overrides":[]},"gridPos":{"h":7,"w":10,"x":14,"y":77},"id":30,"options":{"displayMode":"gradient","minVizHeight":10,"minVizWidth":0,"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showUnfilled":false},"pluginVersion":"9.1.4","targets":[{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"editorMode":"code","expr":"sum by (level) (\n  count_over_time(\n    {app=\"nginx\"}\n    | json\n    [$__range]\n  )\n)","legendFormat":"{{cf_ipcountry}}","queryType":"range","refId":"A"}],"title":"Log Levels","transformations":[],"type":"bargauge"},{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":0,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"always","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"},{"color":"red","value":80}]},"unit":"s"},"overrides":[]},"gridPos":{"h":11,"w":11,"x":0,"y":84},"id":36,"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"single","sort":"none"}},"targets":[{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"editorMode":"code","expr":"sum(\n  sum_over_time(\n    {app=\"nginx\"}\n    | json\n    | connection_time != \"\"\n    | unwrap connection_time\n    [$__interval]\n  )\n)","queryType":"range","refId":"A"}],"title":"Connection Time","type":"timeseries"},{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"gridPos":{"h":11,"w":10,"x":11,"y":84},"id":37,"options":{"dedupStrategy":"none","enableLogDetails":true,"prettifyLogMessage":false,"showCommonLabels":false,"showLabels":false,"showTime":true,"sortOrder":"Descending","wrapLogMessage":false},"pluginVersion":"9.0.1","targets":[{"datasource":{"type":"loki","uid":"${DS_LOKI}"},"editorMode":"code","expr":"{app=\"nginx\"}\n | json\n | referer != \"-\" and referer != \"\" and\n   referer !~ \"^http(s)?://(.*\\\\.)?(hrry|harrybrwn|hryb).(com|lol|dev|me).*$\"\n | line_format \"{{.method}} {{.status}} {{.request_uri}} <= {{.referer}}\"","legendFormat":"{{host}}","queryType":"range","refId":"A"}],"title":"Requests by Referer","transformations":[],"type":"logs"}],"title":"Other Log Aggrigations","type":"row"}],"refresh":"30s","schemaVersion":37,"style":"dark","tags":["nginx","prometheus","nginx prometheus exporter"],"templating":{"list":[{"current":{"selected":false,"text":"prometheus","value":"prometheus"},"hide":0,"includeAll":false,"label":"datasource","multi":false,"name":"DS_PROMETHEUS","options":[],"query":"prometheus","queryValue":"","refresh":1,"regex":"","skipUrlSync":false,"type":"datasource"},{"current":{"selected":false,"text":"loki","value":"loki"},"hide":0,"includeAll":false,"label":"datasource","multi":false,"name":"DS_LOKI","options":[],"query":"loki","queryValue":"","refresh":1,"regex":"","skipUrlSync":false,"type":"datasource"},{"current":{"selected":false,"text":"All","value":"$__all"},"datasource":{"type":"loki","uid":"${DS_PROMETHEUS}"},"definition":"label_values(nginx_up, instance)","hide":0,"includeAll":true,"label":"","multi":true,"name":"instance","options":[],"query":{"query":"label_values(nginx_up, instance)","refId":"prometheus-instance-Variable-Query"},"refresh":1,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-6h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"","title":"NGINX","uid":"MsjffzSZz","version":93,"weekStart":""}
