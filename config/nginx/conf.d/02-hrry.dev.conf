server {
	server_name ip.hrry.dev ip.hrry.local;

	listen      80;
	listen [::]:80;
	listen      443 ssl http2;
	listen [::]:443 ssl http2;
	include 'snippets/hrry.dev-ssl';
	server_tokens off;

	set $geoip geoip:8084;

	location / {
		proxy_set_header  Host              $http_host;
		proxy_set_header  X-Real-IP         $remote_addr;
		proxy_set_header  X-Forwarded-For   $proxy_add_x_forwarded_for;
		proxy_set_header  X-Forwarded-Proto $scheme;
		proxy_pass        http://$geoip;
	}

	location /metrics {
		return 404;
	}
}

server {
	server_name gopkg.hrry.dev
				gopkg.hrry.local;

	listen      80;
	listen [::]:80;
	listen      443 ssl http2;
	listen [::]:443 ssl http2;
	include 'snippets/hrry.dev-ssl';
	server_tokens off;

	set $server vanity-imports:8085;

	location / {
		proxy_pass http://$server;
		# cache in browser for 1 day
		#add_header Cache-Control "public, max-age=86400, must-revalidate, proxy-revalidate";
	}

	location /metrics {
		return 404;
	}
}

server {
	server_name static.hrry.dev
				static.hrry.local;

	listen      443 ssl http2;
	listen [::]:443 ssl http2;

	include 'snippets/hrry.dev-ssl';
	server_tokens off;
	set $s3 s3:9000;

	location / {
		autoindex        on;
		rewrite ^/$ /index.html break;
		proxy_set_header Host $http_host;
		proxy_pass       http://$s3/frontend/latest/harrybrwn.com$request_uri;
		# cache in browser for 1 day
		add_header Cache-Control "public, max-age=86400, must-revalidate";
	}
}